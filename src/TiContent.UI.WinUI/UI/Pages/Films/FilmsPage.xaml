<Page
    x:Class="TiContent.UI.WinUI.UI.Pages.Films.FilmsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:communityToolkit="using:CommunityToolkit.WinUI"
    xmlns:communityToolkitControls="using:CommunityToolkit.WinUI.Controls"
    xmlns:customControls="using:TiContent.UI.WinUI.Components.UI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:TiContent.UI.WinUI.UI.Pages.Films"
    xmlns:vmEntities="using:TiContent.Foundation.Entities.ViewModel"
    d:DataContext="{d:DesignInstance Type=vm:FilmsPageViewModel}"
    mc:Ignorable="d">

    <!--  Root Grid  -->
    <Grid>
        <ScrollView
            x:Name="ScrollView"
            Margin="16"
            ScrollAnimationStarting="ScrollView_ScrollAnimationStarting"
            ViewChanged="ScrollView_OnViewChanged">

            <Grid RowDefinitions="Auto, *" RowSpacing="16">
                <!--  Header Grid  -->
                <Grid
                    Grid.Row="0"
                    ColumnDefinitions="*, Auto"
                    Style="{StaticResource CustomGridCardStyle}">

                    <StackPanel Grid.Column="0" Margin="16,2,0,0">
                        <TextBlock
                            FontWeight="Bold"
                            Style="{ThemeResource TitleTextBlockStyle}"
                            Text="Фильмы &amp; Сериалы" />

                        <TextBlock
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Style="{ThemeResource BodyStrongTextBlockStyle}"
                            Text="Обширный каталог Фильмов и Сериалов от TMDB" />
                    </StackPanel>

                    <StackPanel Grid.Column="1" Spacing="4">
                        <communityToolkitControls:Segmented IsEnabled="{x:Bind ViewModel.ContentTypeIsEnabled, Mode=OneWay}" SelectedIndex="{x:Bind ViewModel.ContentType, Mode=TwoWay}">
                            <communityToolkitControls:SegmentedItem
                                Content="Фильмы"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Icon="{communityToolkit:FontIcon Glyph='&#xE8B2;'}" />

                            <communityToolkitControls:SegmentedItem
                                Content="Сериалы"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Icon="{communityToolkit:FontIcon Glyph='&#xE7F4;'}" />

                            <communityToolkitControls:SegmentedItem
                                Content="Аниме"
                                FontSize="14"
                                FontWeight="SemiBold"
                                Icon="{communityToolkit:FontIcon Glyph='&#xE7F4;'}"
                                Visibility="Collapsed" />
                        </communityToolkitControls:Segmented>

                        <AutoSuggestBox
                            x:Name="AutoSuggestBox"
                            GettingFocus="AutoSuggestBox_OnGettingFocus"
                            ItemsSource="{x:Bind ViewModel.QueryHistoryItems, Mode=OneWay}"
                            PlaceholderText="Поиск по каталогу"
                            PointerPressed="AutoSuggestBox_OnPointerPressed"
                            SuggestionChosen="AutoSuggestBox_OnSuggestionChosen"
                            Text="{x:Bind ViewModel.Query, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">

                            <AutoSuggestBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="*, Auto">
                                        <TextBlock
                                            Grid.Column="0"
                                            Margin="0,0,0,1"
                                            VerticalAlignment="Center"
                                            Style="{ThemeResource BodyTextBlockStyle}"
                                            Text="{Binding}" />

                                        <Button
                                            Grid.Column="1"
                                            Width="24"
                                            Height="24"
                                            Padding="0"
                                            Click="ClearHistoryItemButton_OnClick"
                                            ClickMode="Press"
                                            CommandParameter="{Binding}">

                                            <FontIcon FontSize="9" Glyph="&#xE894;" />
                                        </Button>
                                    </Grid>
                                </DataTemplate>
                            </AutoSuggestBox.ItemTemplate>
                        </AutoSuggestBox>
                    </StackPanel>
                </Grid>

                <!--  Content  -->
                <ItemsControl
                    Grid.Row="1"
                    ItemsSource="{x:Bind ViewModel.Items, Mode=TwoWay}"
                    Visibility="{x:Bind ViewModel.State, Converter={StaticResource ViewStateToVisibilityConverter}, Mode=OneWay}">

                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VirtualizingStackPanel Orientation="Vertical" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="vmEntities:FilmsPageItemEntity">
                            <communityToolkitControls:SettingsCard
                                Margin="0,0,0,4"
                                Click="SettingsCard_OnClick"
                                CommandParameter="{x:Bind Id}"
                                IsClickEnabled="True">

                                <communityToolkitControls:SettingsCard.Header>
                                    <Grid ColumnDefinitions="Auto, *" ColumnSpacing="16">
                                        <Border
                                            Grid.Column="0"
                                            Background="{ThemeResource AcrylicBackgroundFillColorBaseBrush}"
                                            CornerRadius="8">

                                            <Image
                                                Width="100"
                                                Height="142"
                                                Loaded="Image_OnLoaded"
                                                Stretch="Fill"
                                                Tag="{x:Bind ImageUrl}" />
                                        </Border>

                                        <StackPanel Grid.Column="1" Orientation="Vertical">
                                            <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="{x:Bind Title}" />

                                            <TextBlock Style="{StaticResource BodyTextBlockStyle}">
                                                <Run Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text="{x:Bind OriginalTitle}" />
                                                <Run
                                                    FontWeight="SemiBold"
                                                    Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                    Text="{x:Bind Year}" />
                                            </TextBlock>

                                            <TextBlock
                                                Margin="0,4,0,0"
                                                Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                                MaxLines="3"
                                                Style="{StaticResource CaptionTextBlockStyle}"
                                                Text="{x:Bind Description}"
                                                TextWrapping="Wrap"
                                                Visibility="{x:Bind Description, Converter={StaticResource NullToVisibilityConverter}}" />

                                            <TextBlock Margin="0,4,0,0" Style="{StaticResource BodyTextBlockStyle}">
                                                <Run
                                                    FontWeight="SemiBold"
                                                    Foreground="{x:Bind Vote, Converter={StaticResource VoteToColorConverter}}"
                                                    Text="{x:Bind Vote}" />
                                                <Run
                                                    FontSize="9"
                                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                                    Text="{x:Bind VoteCount}" />
                                            </TextBlock>
                                        </StackPanel>
                                    </Grid>
                                </communityToolkitControls:SettingsCard.Header>
                            </communityToolkitControls:SettingsCard>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!--  Placeholder  -->
                <customControls:PlaceholderUserControl Grid.Row="1" State="{x:Bind ViewModel.State, Mode=OneWay}" />
            </Grid>
        </ScrollView>

        <!--  ScrollToTop Button  -->
        <Button
            x:Name="ScrollToTopButton"
            Width="64"
            Height="64"
            Margin="0,0,32,32"
            Padding="18,16,16,16"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Click="ScrollToTopButton_OnClick"
            Content="{communityToolkit:FontIcon Glyph=&#xF0AD;}"
            CornerRadius="32"
            IsHitTestVisible="False"
            Opacity="0">

            <Button.OpacityTransition>
                <ScalarTransition />
            </Button.OpacityTransition>
        </Button>
    </Grid>
</Page>