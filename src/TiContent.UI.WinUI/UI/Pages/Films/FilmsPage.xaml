<Page
    x:Class="TiContent.UI.WinUI.UI.Pages.Films.FilmsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:customControls="using:TiContent.UI.WinUI.Components.UI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:films="using:TiContent.UI.WinUI.UI.Pages.Films"
    xmlns:filmsPage="using:TiContent.Foundation.Entities.ViewModel.FilmsPage"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:viewModel="using:TiContent.Foundation.Entities.ViewModel"
    d:DataContext="{d:DesignInstance Type=films:FilmsPageViewModel,
                                     IsDesignTimeCreatable=True}"
    mc:Ignorable="d">

    <Grid
        Margin="16"
        ColumnDefinitions="*,0.35*"
        ColumnSpacing="8"
        RowDefinitions="Auto, *">

        <TextBlock
            Margin="32,8,0,24"
            FontWeight="Bold"
            Style="{ThemeResource TitleTextBlockStyle}"
            Text="Фильмы &amp; Сериалы" />

        <ItemsControl
            Name="ItemsControl"
            Grid.Row="1"
            Grid.Column="0"
            ItemsSource="{x:Bind ViewModel.Items, Mode=TwoWay}"
            Visibility="{x:Bind ViewModel.State, Converter={StaticResource ViewStateToVisibilityConverter}, Mode=OneWay}">

            <ItemsControl.Template>
                <ControlTemplate>
                    <ScrollView Name="ItemsControlScrollView" ViewChanged="ScrollView_OnViewChanged">
                        <ItemsPresenter />
                    </ScrollView>
                </ControlTemplate>
            </ItemsControl.Template>

            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <VirtualizingStackPanel Orientation="Vertical" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="filmsPage:FilmsPageItemEntity">
                    <controls:SettingsCard
                        Margin="0,0,0,4"
                        Click="SettingsCard_OnClick"
                        CommandParameter="{x:Bind Id}"
                        IsClickEnabled="True">

                        <controls:SettingsCard.Header>
                            <Grid ColumnDefinitions="Auto, *" ColumnSpacing="16">
                                <Border
                                    Grid.Column="0"
                                    Background="{ThemeResource AcrylicBackgroundFillColorBaseBrush}"
                                    CornerRadius="8">

                                    <Image
                                        Width="100"
                                        Height="142"
                                        Loaded="Image_OnLoaded"
                                        Stretch="Fill"
                                        Tag="{x:Bind ImageUrl}" />
                                </Border>

                                <StackPanel Grid.Column="1" Orientation="Vertical">
                                    <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="{x:Bind Title}" />

                                    <TextBlock Style="{StaticResource BodyTextBlockStyle}">
                                        <Run Foreground="{ThemeResource TextFillColorSecondaryBrush}" Text="{x:Bind OriginalTitle}" />
                                        <Run
                                            FontWeight="SemiBold"
                                            Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                            Text="{x:Bind Year}" />
                                    </TextBlock>

                                    <TextBlock
                                        Margin="0,4,0,0"
                                        Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                        MaxLines="3"
                                        Style="{StaticResource CaptionTextBlockStyle}"
                                        Text="{x:Bind Description}"
                                        TextWrapping="Wrap"
                                        Visibility="{x:Bind Description, Converter={StaticResource NullToVisibilityConverter}}" />

                                    <TextBlock Margin="0,4,0,0" Style="{StaticResource BodyTextBlockStyle}">
                                        <Run
                                            FontWeight="SemiBold"
                                            Foreground="{x:Bind Vote, Converter={StaticResource VoteToColorConverter}}"
                                            Text="{x:Bind Vote}" />
                                        <Run
                                            FontSize="9"
                                            Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                            Text="{x:Bind VoteCount}" />
                                    </TextBlock>
                                </StackPanel>
                            </Grid>
                        </controls:SettingsCard.Header>
                    </controls:SettingsCard>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <customControls:PlaceholderUserControl
            Grid.Row="1"
            Grid.Column="0"
            State="{x:Bind ViewModel.State, Mode=OneWay}" />

        <Grid
            Column="1"
            Row="1"
            RowDefinitions="Auto, Auto, *"
            RowSpacing="8">

            <AutoSuggestBox
                x:Name="AutoSuggestBox"
                Grid.Row="0"
                GettingFocus="AutoSuggestBox_OnGettingFocus"
                ItemsSource="{x:Bind ViewModel.QueryHistoryItems, Mode=OneWay}"
                PlaceholderText="Поиск по каталогу"
                PointerPressed="AutoSuggestBox_OnPointerPressed"
                SuggestionChosen="AutoSuggestBox_OnSuggestionChosen"
                Text="{x:Bind ViewModel.Query, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">

                <AutoSuggestBox.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="*, Auto">
                            <TextBlock
                                Grid.Column="0"
                                Margin="0,0,0,1"
                                VerticalAlignment="Center"
                                Style="{ThemeResource BodyTextBlockStyle}"
                                Text="{Binding}" />

                            <Button
                                Grid.Column="1"
                                Width="24"
                                Height="24"
                                Padding="0"
                                Click="ClearHistoryItemButton_OnClick"
                                ClickMode="Press"
                                CommandParameter="{Binding}">

                                <FontIcon FontSize="9" Glyph="&#xE894;" />
                            </Button>
                        </Grid>
                    </DataTemplate>
                </AutoSuggestBox.ItemTemplate>
            </AutoSuggestBox>

            <controls:Segmented
                Grid.Row="1"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                IsEnabled="{x:Bind ViewModel.ContentTypeIsEnabled, Mode=OneWay}"
                SelectedIndex="{x:Bind ViewModel.ContentType, Mode=TwoWay}">

                <controls:SegmentedItem
                    Content="Фильмы"
                    FontSize="14"
                    FontWeight="SemiBold"
                    Icon="{ui:FontIcon Glyph='&#xE8B2;'}" />

                <controls:SegmentedItem
                    Content="Сериалы"
                    FontSize="14"
                    FontWeight="SemiBold"
                    Icon="{ui:FontIcon Glyph='&#xE7F4;'}" />
            </controls:Segmented>
        </Grid>
    </Grid>
</Page>
