<Page
    x:Class="TiContent.WinUI.UI.Pages.Games.GamesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:controls1="using:TiContent.WinUI.Components.UI.Controls"
    xmlns:customControls="using:TiContent.WinUI.Components.UI"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ets="using:TiContent.Entities.ViewModel"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="using:CommunityToolkit.WinUI"
    mc:Ignorable="d">

    <Grid
        Margin="16"
        ColumnDefinitions="*,0.35*"
        ColumnSpacing="8"
        RowDefinitions="Auto, *">

        <TextBlock
            Margin="32,8,0,24"
            FontWeight="Bold"
            Style="{ThemeResource TitleTextBlockStyle}"
            Text="Игры" />

        <ItemsControl
            x:Name="ItemsControl"
            Grid.Row="1"
            Grid.Column="0"
            ItemsSource="{x:Bind ViewModel.Items, Mode=OneWay}"
            Visibility="{x:Bind ViewModel.State, Converter={StaticResource ViewStateToVisibilityConverter}, Mode=OneWay}">

            <ItemsControl.Template>
                <ControlTemplate>
                    <ScrollView ViewChanged="ScrollView_OnViewChanged">
                        <ItemsPresenter />
                    </ScrollView>
                </ControlTemplate>
            </ItemsControl.Template>

            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <VirtualizingStackPanel />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="ets:GamesPageItemEntity">
                    <Expander HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                        <Expander.Header>
                            <Grid
                                Margin="0,16,0,16"
                                ColumnDefinitions="Auto, *"
                                ColumnSpacing="16">

                                <Border Grid.Column="0" CornerRadius="8">
                                    <Image
                                        Width="230"
                                        Height="108"
                                        Source="{x:Bind ImageUrl}"
                                        Stretch="Fill" />
                                </Border>

                                <StackPanel Grid.Column="1" Spacing="4">
                                    <TextBlock Style="{StaticResource SubtitleTextBlockStyle}" Text="{x:Bind Title}" />
                                    <StackPanel>
                                        <TextBlock
                                            Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                            MaxLines="1"
                                            Style="{StaticResource CaptionTextBlockStyle}"
                                            Text="{x:Bind Shop}" />

                                        <TextBlock
                                            Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                            MaxLines="1"
                                            Style="{StaticResource CaptionTextBlockStyle}"
                                            Text="{x:Bind Publisher}"
                                            Visibility="{x:Bind Publisher, Converter={StaticResource NullToVisibilityConverter}}" />

                                        <TextBlock
                                            Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                            MaxLines="1"
                                            Style="{StaticResource CaptionTextBlockStyle}"
                                            Text="{x:Bind Genres}"
                                            Visibility="{x:Bind Genres, Converter={StaticResource NullToVisibilityConverter}}" />
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Expander.Header>

                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <DropDownButton Content="Открыть" CornerRadius="16">
                                <DropDownButton.Flyout>
                                    <MenuFlyout Placement="Bottom">
                                        <MenuFlyoutItem
                                            Click="MenuFlyoutItem_OnClick"
                                            CommandParameter="{x:Bind Id}"
                                            Tag="0"
                                            Text="Google" />
                                        <MenuFlyoutSeparator />

                                        <MenuFlyoutItem
                                            Click="MenuFlyoutItem_OnClick"
                                            CommandParameter="{x:Bind Id}"
                                            Tag="1"
                                            Text="RuTracker" />

                                        <MenuFlyoutItem
                                            Click="MenuFlyoutItem_OnClick"
                                            CommandParameter="{x:Bind Id}"
                                            Tag="2"
                                            Text="Rutor" />
                                    </MenuFlyout>
                                </DropDownButton.Flyout>
                            </DropDownButton>

                            <Button
                                Click="HydraLinksButton_OnClick"
                                CommandParameter="{x:Bind Id}"
                                Content="Источники"
                                CornerRadius="16" />
                        </StackPanel>
                    </Expander>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <controls1:PlaceholderUserControl
            Grid.Row="1"
            Grid.Column="0"
            State="{x:Bind ViewModel.State, Mode=OneWay}" />

        <Grid
            Column="1"
            Row="1"
            RowDefinitions="Auto, Auto, *"
            RowSpacing="8">

            <AutoSuggestBox
                x:Name="AutoSuggestBox"
                Grid.Row="0"
                GettingFocus="AutoSuggestBox_OnGettingFocus"
                ItemsSource="{x:Bind ViewModel.QueryHistoryItems, Mode=OneWay}"
                PlaceholderText="Поиск по каталогу"
                PointerPressed="AutoSuggestBox_OnPointerPressed"
                SuggestionChosen="AutoSuggestBox_OnSuggestionChosen"
                Text="{x:Bind ViewModel.Query, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">

                <AutoSuggestBox.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="*, Auto">
                            <TextBlock
                                Grid.Column="0"
                                Margin="0,0,0,1"
                                VerticalAlignment="Center"
                                Style="{ThemeResource BodyTextBlockStyle}"
                                Text="{Binding}" />

                            <Button
                                Grid.Column="1"
                                Width="24"
                                Height="24"
                                Padding="0"
                                Click="ClearHistoryItemButton_OnClick"
                                ClickMode="Press"
                                CommandParameter="{Binding}">

                                <FontIcon FontSize="9" Glyph="&#xE894;" />
                            </Button>
                        </Grid>
                    </DataTemplate>
                </AutoSuggestBox.ItemTemplate>
            </AutoSuggestBox>

            <controls:Segmented
                Grid.Row="1"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                Header="Популярно"
                IsEnabled="{x:Bind ViewModel.ContentTypeIsEnabled}"
                SelectedIndex="{x:Bind ViewModel.ContentTypeIndex, Mode=TwoWay}">

                <controls:SegmentedItem
                    Content="Каталог"
                    FontSize="14"
                    FontWeight="SemiBold"
                    Icon="{ui:FontIcon Glyph='&#xE8F1;'}" />

                <controls:SegmentedItem
                    Content="Популярно"
                    FontSize="14"
                    FontWeight="SemiBold"
                    Icon="{ui:FontIcon Glyph='&#xECAD;'}" />
            </controls:Segmented>
        </Grid>
    </Grid>
</Page>
